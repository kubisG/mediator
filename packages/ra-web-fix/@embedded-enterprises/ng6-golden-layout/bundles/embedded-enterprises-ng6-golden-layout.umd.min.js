!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("golden-layout"),require("@angular/common")):"function"==typeof define&&define.amd?define("@embedded-enterprises/ng6-golden-layout",["exports","@angular/core","golden-layout","@angular/common"],t):t((e["embedded-enterprises"]=e["embedded-enterprises"]||{},e["embedded-enterprises"]["ng6-golden-layout"]={}),e.ng.core,e.GoldenLayout,e.ng.common)}(this,function(e,l,i,t){"use strict";function c(e){var t="function"==typeof Symbol&&e[Symbol.iterator],o=0;return t?t.call(e):{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}}}function a(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,i,r=o.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)a.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(o=r["return"])&&o.call(r)}finally{if(i)throw i.error}}return a}var o=new l.InjectionToken("GoldenLayoutConfiguration"),n=new l.InjectionToken("GoldenLayoutStateStore"),r="$ng-golden-layout-state",s=function(){function e(e){this.key=e}return e.prototype.writeState=function(e){localStorage.setItem(this.key,JSON.stringify(e))},e.prototype.loadState=function(){var e=localStorage.getItem(this.key);return e?Promise.resolve(JSON.parse(e)):Promise.reject("No state found using key: "+this.key)},e}();function u(){return new s(r)}var d=new s(r),p={provide:n,useFactory:u},f=function(){function e(e,t){this.config=e,this.stateStore=t,this._layout=null}return e.prototype.initialize=function(o,n){var e=this;this._layout=o,this.config.components.forEach(function(e){var t=n.createComponentInitCallback(e.component);o.registerComponent(e.componentName,t)}),this.stateStore&&o.on("stateChanged",function(){e._saveState(o)})},e.prototype._saveState=function(e){if(this.stateStore&&e.isInitialised)try{this.stateStore.writeState(e.toConfig())}catch(t){}},e.prototype.getState=function(){var e=this;return this.stateStore?this.stateStore.loadState()["catch"](function(){return e.config.defaultLayout}):Promise.resolve(this.config.defaultLayout)},e.prototype.getRegisteredComponents=function(){return this.config.components},e.prototype.createNewComponent=function(e,t,o){var n=this._layout.createContentItem({type:"component",componentName:e.componentName,componentState:o,title:t}),i=this._layout.root,r=null;if(null===(r=i.contentItems&&0!==i.contentItems.length?this.findStack(i.contentItems):i))throw new Error("this should never happen!");r.addChild(n)},e.prototype.findStack=function(e){if(!e)return null;try{for(var t=c(e),o=t.next();!o.done;o=t.next()){var n=o.value;if("stack"===n.type)return n;var i=this.findStack(n.contentItems);if(null!==i)return i}}catch(l){r={error:l}}finally{try{o&&!o.done&&(a=t["return"])&&a.call(t)}finally{if(r)throw r.error}}var r,a},e.prototype.isChildWindow=function(){return!!window.opener},e.prototype.getRootWindow=function(){return window.opener||window},e}();f.decorators=[{type:l.Injectable}],f.ctorParameters=function(){return[{type:o,decorators:[{type:l.Inject,args:[o]}]},{type:undefined,decorators:[{type:l.Optional},{type:l.Inject,args:[n]}]}]};var y=new l.InjectionToken("fallback component"),h=new l.InjectionToken("failed component"),g=new l.InjectionToken("GoldenLayoutContainer"),m=new l.InjectionToken("GoldenLayoutComponentState");var v=function w(){var o=this;this.promise=new Promise(function(e,t){o.resolve=e,o.reject=t})},_=function(){function e(e,t,o,n,i,r,a){this.glService=e,this.viewContainer=t,this.appref=o,this.componentFactoryResolver=n,this.ngZone=i,this.injector=r,this.fallbackComponent=a,this.unloaded=!1,this.onUnloaded=new v,this.fallbackType=null,this.topWindow=e.getRootWindow(),this.isChildWindow=e.isChildWindow(),a&&(this.fallbackType=this.createComponentInitCallback(a)),this.isChildWindow&&(window.document.title=window.document.URL,console.__log=console.log,console.log=this.topWindow.console.log),l.isDevMode()&&console.log("Create@"+(this.isChildWindow?"child":"root")+"!")}return e.prototype.ngOnInit=function(){var a=this;l.isDevMode()&&console.log("Init@"+(this.isChildWindow?"child":"root")+"!");var e=this.topWindow;this.isChildWindow||(e.__apprefs=[],e.__injector=this.injector),e.__apprefs.push(this.appref),this.appref.__tick=this.appref.tick,this.appref.tick=function(){var e,t,o=function(e){e._zone.run(function(){return e.__tick()})};try{for(var n=c(a.topWindow.__apprefs),i=n.next();!i.done;i=n.next()){o(i.value)}}catch(r){e={error:r}}finally{try{i&&!i.done&&(t=n["return"])&&t.call(n)}finally{if(e)throw e.error}}},this.glService.getState().then(function(e){a._createLayout(e)})},e.prototype.ngOnDestroy=function(){l.isDevMode()&&console.log("Destroy@"+(this.isChildWindow?"child":"root")+"!"),this.isChildWindow&&(console.log=console.__log),this.unloaded=!0,this.appref.tick=this.appref.__tick},e.prototype.unloadHandler=function(){if(l.isDevMode()&&console.log("Unload@"+(this.isChildWindow?"child":"root")),!this.unloaded&&(this.onUnloaded.resolve(),this.unloaded=!0,this.isChildWindow)){var e=this.topWindow.__apprefs.indexOf(this.appref);this.topWindow.__apprefs.splice(e,1)}},e.prototype._createLayout=function(e){var o=this;this.goldenLayout=new i(e,$(this.el.nativeElement)),this.goldenLayout.getComponent=function(e){var t=o.goldenLayout._components[e]||o.fallbackType;if(!t)throw new Error('Unknown component "'+e+'"');return t},this.glService.initialize(this.goldenLayout,this),this.goldenLayout.init()},e.prototype.onResize=function(e){this.goldenLayout&&this.goldenLayout.updateSize()},e.prototype.createComponentInitCallback=function(l){var c=this;return function(r,a){c.ngZone.run(function(){var e=c.componentFactoryResolver.resolveComponentFactory(l),t=null;l===c.fallbackComponent&&(t=r._config.componentName);var o=c._createComponentInjector(r,a,t),n=c.viewContainer.createComponent(e,undefined,o);r.getElement().append($(n.location.nativeElement)),c._bindEventHooks(r,n.instance);var i=!1;r.on("destroy",function(){i||(i=!0,$(n.location.nativeElement).remove(),n.destroy())}),c.onUnloaded.promise.then(function(){i||(i=!0,$(n.location.nativeElement).remove(),n.destroy())})})}},e.prototype._createComponentInjector=function(e,t,o){var n=[{provide:g,useValue:e},{provide:m,useValue:t},{provide:i,useValue:this.goldenLayout}];return o&&n.push({provide:h,useValue:o}),l.Injector.create(n,this.injector)},e.prototype._bindEventHooks=function(e,t){if(function o(e){return"object"==typeof e&&"function"==typeof e.glOnResize}(t)&&e.on("resize",function(){t.glOnResize()}),function n(e){return"object"==typeof e&&"function"==typeof e.glOnShow}(t)&&e.on("show",function(){t.glOnShow()}),function i(e){return"object"==typeof e&&"function"==typeof e.glOnHide}(t)&&e.on("hide",function(){t.glOnHide()}),function r(e){return"object"==typeof e&&"function"==typeof e.glOnTab}(t)&&e.on("tab",function(e){t.glOnTab(e)}),function a(e){return"object"==typeof e&&"function"==typeof e.glOnClose}(t)){var l=!1;e.on("tab",function(t){if(!l){l=!0,t.closeElement.off("click");t._onCloseClick.bind(t);t._onCloseClick=function(e){e.stopPropagation(),t.contentItem.container.close()},t._onCloseClickFn=t._onCloseClick.bind(t),t.closeElement.click(t._onCloseClickFn)}});var c=e.close.bind(e);e.close=function(){if(console.log("Container close:",e),!e._config.isClosable)return!1;t.glOnClose().then(function(){c()},function(){})}}},e}();_.decorators=[{type:l.Component,args:[{selector:"golden-layout-root",styles:["\n    .ng-golden-layout-root {\n      width:100%;\n      height:100%;\n    }"],template:'<div class="ng-golden-layout-root" #glroot></div>'}]}],_.ctorParameters=function(){return[{type:f},{type:l.ViewContainerRef},{type:l.ApplicationRef},{type:l.ComponentFactoryResolver},{type:l.NgZone},{type:l.Injector},{type:undefined,decorators:[{type:l.Optional},{type:l.Inject,args:[y]}]}]},_.propDecorators={el:[{type:l.ViewChild,args:["glroot"]}],unloadHandler:[{type:l.HostListener,args:["window:beforeunload"]}],onResize:[{type:l.HostListener,args:["window:resize",["$event"]]}]};var C=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[f,{provide:o,useValue:e}]}},t}();C.decorators=[{type:l.NgModule,args:[{declarations:[_],exports:[_],imports:[t.CommonModule]}]}],e.GoldenLayoutConfiguration=o,e.GoldenLayoutContainer=g,e.GoldenLayoutComponentState=m,e.GoldenLayoutComponent=_,e.GoldenLayoutService=f,e.GoldenLayoutModule=C,e.GoldenLayoutStateStore=n,e.DEFAULT_LOCAL_STORAGE_STATE_STORE_KEY=r,e.LocalStorageStateStore=s,e.DEFAULT_LOCAL_STORAGE_STATE_STORE_FACTORY=u,e.DEFAULT_LOCAL_STORAGE_STATE_STORE=d,e.DEFAULT_LOCAL_STORAGE_STATE_STORE_PROVIDER=p,e.MultiWindowInit=function S(){window.opener||(window.__services=new window.Map,window.__serviceConstructors=new window.Map)},e.MultiWindowService=function k(){return function(e){var i=e,r=window.opener||window,t=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!r.__services.has(i.name)){var o=r.__serviceConstructors.get(i.name)||i;r.__services.set(i.name,new(o.bind.apply(o,function n(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}([void 0],e))))}return r.__services.get(i.name)};if(window===r){var o=Reflect.getMetadata("design:paramtypes",i);Reflect.metadata("design:paramtypes",o)(t)}return t}},e.FallbackComponent=y,e.FailedComponent=h,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=embedded-enterprises-ng6-golden-layout.umd.min.js.map
