<mat-toolbar raDraggable [ngClass]="{'back-blue': orderForm.controls['Side'].value === 'Buy', 'back-red': orderForm.controls['Side'].value !== 'Buy' }">
    {{'new.order.detail' | translate }}
    <span class="fill-remaining-space"></span>
    <button *ngIf="!data.data.ClOrdLinkID" matTooltip="{{'butt.save' | translate}}" mat-icon-button (click)="saveDeal()">
        <mat-icon aria-label="Save">save_alt</mat-icon>
    </button>
    <button matTooltip="{{'basic.dialog' | translate}}" mat-icon-button (click)="switchDialog('B')">
        <mat-icon>tab_unselected</mat-icon>
    </button>
    <button matTooltip="{{'advanced.dialog' | translate}}" mat-icon-button (click)="switchDialog('A')">
        <mat-icon>tab</mat-icon>
    </button>

</mat-toolbar>
<div [ngClass]="{'font-blue': orderForm.controls['Side'].value === 'Buy', 'font-red': orderForm.controls['Side'].value !== 'Buy' }">
    <div mat-dialog-content>
        <div *ngIf="!inicialized">
            <div class="spinner-holder">
                <mat-spinner color="warn"></mat-spinner>
            </div>
        </div>

        <form *ngIf="inicialized" [formGroup]="orderForm">
            <div class="row">
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <ra-input-rule-select formControlName="Side" [selector]="['Side']" [inputRules]="inputRules"
                        [disabledInput]="data.action === 'R' || ((data.data) && (data.data.ClOrdLinkID))" [placeholder]="'Side'"
                        [required]="true"></ra-input-rule-select>
                </div>

                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field>
                        <input formControlName="OrderQty" name="OrderQty" matInput required type="text" placeholder="Quantity" mask="comma_separator.0" [raPressKey]="orderForm">
                        <mat-error *ngIf="((data.data) && (data.data.ClOrdLinkID))">
                            Sum of child quantities is bigger than parent quantity
                        </mat-error>
                    </mat-form-field>
                </div>

                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                </div>
                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <mat-form-field *ngIf="data.appType !== appType.Self">
                        <input formControlName="OnBehalfOfSubID" name="OnBehalfOfSubID" matInput readonly placeholder="Dealer ID">
                    </mat-form-field>
                </div>
                <div class="col-md-4" *ngIf="formType === 'A'">
                    <mat-form-field *ngIf="accounts">
                        <mat-select formControlName="Account" name="Account" placeholder="Account">
                            <mat-option>Allocation to follow</mat-option>
                            <mat-option *ngFor="let account of accounts" [value]="account.name">
                                {{account.name}} - {{account.code}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>

            <div class="row" *ngIf="data.appType === appType.Self">
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field *ngIf="clients">
                            <mat-select formControlName="ClientID" name="ClientID" placeholder="ClientID">
                                <mat-option *ngFor="let client of clients" [value]="client.DeliveryToCompID">
                                        {{client.CounterParty}} - {{client.DeliveryToCompID}}
                                </mat-option>
                            </mat-select>
                    </mat-form-field>
                </div>
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field>
                        <input formControlName="OnBehalfOfSubID" name="OnBehalfOfSubID" matInput placeholder="Dealer ID">
                    </mat-form-field>
                </div>
                <div class="col-md-8" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                </div>                
            </div>

            <div class="row" *ngIf="data.action === 'R'">
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-3': formType === 'B'}">
                    <mat-form-field>
                        <input formControlName="CumQty" name="CumQty" matInput type="text" placeholder="Cumulated Quantity" mask="comma_separator.0">
                    </mat-form-field>
                </div>
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-3': formType === 'B'}">
                    <mat-form-field>
                        <input formControlName="AvgPx" name="AvgPx" matInput required type="text" placeholder="Average Price"
                            mask="comma_separator.4">
                    </mat-form-field>
                </div>
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field>
                        <input formControlName="NewOrderQty" name="NewOrderQty" matInput required type="text" mask="comma_separator.0"
                            placeholder="New Quantity" [raPressKey]="orderForm">
                        <mat-error>
                            Quantity is lower than already cumulated quantity
                        </mat-error>
                    </mat-form-field>
                </div>
                <div class="col-md-6" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                </div>
            </div>

            <div class="row">

                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <ra-input-rule-select formControlName="Symbol" [selector]="['Symbol']" [inputRules]="inputRules"
                        [disabledInput]="data.action === 'R' || data.data.ClOrdLinkID" [placeholder]="'Symbol'" [required]="true"></ra-input-rule-select>
                </div>

                <div class="col-md-4" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <ra-input-rule-select formControlName="SecurityDesc" [selector]="[['Symbol',orderForm.controls['Symbol'].value],'SecurityDesc']"
                        [disabledInput]="true" [inputRules]="inputRules" [placeholder]="'Stock Name'"></ra-input-rule-select>
                </div>

                <div class="col-md-6" *ngIf="formType === 'B'">
                    <mat-form-field *ngIf="accounts">
                        <mat-select formControlName="Account" name="Account" placeholder="Account">
                            <mat-option>Allocation to follow</mat-option>
                            <mat-option *ngFor="let account of accounts" [value]="account.name">
                                {{account.name}} - {{account.code}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <ra-input-rule-select formControlName="SecurityID" [selector]="[['Symbol',orderForm.controls['Symbol'].value],'SecurityID']"
                        [inputRules]="inputRules" [placeholder]="'Security ID'"></ra-input-rule-select>
                </div>
                <div class="col-md-4" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <ra-input-rule-select formControlName="SecurityIDSource" [selector]="[['Symbol',orderForm.controls['Symbol'].value],['SecurityID',orderForm.controls['SecurityID'].value],'SecurityIDSource']"
                        [disabledInput]="true" [inputRules]="inputRules" [placeholder]="'Security ID Source'"></ra-input-rule-select>
                </div>
            </div>

            <div class="row">
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-12': formType === 'B'}">
                    <ra-input-rule-select formControlName="OrdType" [selector]="['OrdType']" [inputRules]="inputRules"
                        [placeholder]="'Order Type'" [required]="true"></ra-input-rule-select>
                </div>

                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <ra-input-rule-select formControlName="HandlInst" [selector]="['HandlInst']" [inputRules]="inputRules"
                        [placeholder]="'Handl Inst'" [required]="true"></ra-input-rule-select>
                </div>

                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                </div>

                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <mat-checkbox [disabled]="this.data.action === 'R'" (change)="changeBooking($event)" [checked]="bookingCheck">CFD
                        Yes/No</mat-checkbox>
                    <input type="hidden" formControlName="BookingType" name="BookingType">
                </div>

                <div class="col-md-4" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <mat-form-field>
                        <input formControlName="TradeDate" name="TradeDate" matInput readonly [matDatepicker]="tradePicker"
                            placeholder="Trade Date" (dateChange)="onTradeDate($event)">
                        <mat-datepicker-toggle matSuffix [for]="tradePicker"></mat-datepicker-toggle>
                        <mat-datepicker #tradePicker></mat-datepicker>
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field [ngStyle]="{'display':(orderForm.controls['OrdType'].value === 'Limit' || orderForm.controls['OrdType'].value === 'StopLimit' || orderForm.controls['OrdType'].value === 'Stop') ? 'block' : 'none'}">
                        <input [required]="orderForm.controls['OrdType'].value === 'Limit' || orderForm.controls['OrdType'].value === 'StopLimit' || orderForm.controls['OrdType'].value === 'Stop'"
                            formControlName="Price" name="Price" matInput type="text" placeholder="Price" mask="comma_separator.4" [raPressKey]="orderForm">
                    </mat-form-field>
                </div>

                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field [ngStyle]="{'display':(orderForm.controls['OrdType'].value === 'StopLimit' || orderForm.controls['OrdType'].value === 'Stop') ? 'block' : 'none'}">
                        <input [required]="orderForm.controls['OrdType'].value === 'StopLimit' || orderForm.controls['OrdType'].value === 'Stop'"
                            formControlName="StopPx" name="StopPx" matInput type="text" placeholder="Stop Px" mask="comma_separator.4" [raPressKey]="orderForm">
                    </mat-form-field>
                </div>
                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                </div>
                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <span *ngIf="user && user.appPref && user.appPref.OddLot">
                        <mat-checkbox formControlName="OddLot">Odd Lots Yes/No</mat-checkbox>
                    </span>
                </div>

                <div class="col-md-4" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <mat-form-field>
                        <input formControlName="SettlDate" name="SettlDate" matInput [matDatepicker]="settlePicker"
                            placeholder="Settlement Date">
                        <mat-datepicker-toggle matSuffix [for]="settlePicker"></mat-datepicker-toggle>
                        <mat-datepicker #settlePicker></mat-datepicker>
                    </mat-form-field>
                </div>
            </div>

            <div class="row">
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-12': formType === 'B'}">
                    <ra-input-rule-select formControlName="Currency" [required]="true" [selector]="[['Symbol',orderForm.controls['Symbol'].value],'Currency']"
                        [inputRules]="inputRules" [disabledInput]="data.action === 'R'" [placeholder]="'Currency'" [showAll]="true"></ra-input-rule-select>
                </div>
                <div class="col-md-4" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                </div>
                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <mat-checkbox formControlName="LocateReqd">Stock locate Required</mat-checkbox>
                </div>
                <div class="col-md-4" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <ra-input-rule-select formControlName="ExecInst" [selector]="['ExecInst']" [inputRules]="inputRules"
                        [placeholder]="'Execution Instructions'" [emptyValue]="true"></ra-input-rule-select>
                </div>
            </div>

            <div class="row" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                <div class="col-md-2">
                    <ra-input-rule-select formControlName="TimeInForce" [required]="true" [selector]="['TimeInForce']"
                        [inputRules]="inputRules" [placeholder]="'TIF'"></ra-input-rule-select>
                </div>
                <div class="col-md-6">
                </div>


                <div class="col-md-4">
                </div>
            </div>

            <div class="row" [ngStyle]="{'display':data.appType === appType.Self ? 'none': 'flex'}">

                <div class="col-md-2" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                    <mat-form-field>
                        <input [required]="orderForm.controls['TimeInForce'].value === 'GoodTillDate'" formControlName="ExpireDate"
                            name="ExpireDate" matInput [matDatepicker]="gtdPicker" placeholder="GTD Expire Date">
                        <mat-datepicker-toggle matSuffix [for]="gtdPicker"></mat-datepicker-toggle>
                        <mat-datepicker #gtdPicker></mat-datepicker>
                    </mat-form-field>
                </div>
                <div class="col-md-4" [ngStyle]="{'display':formType === 'A' ? 'block' : 'none'}">
                </div>
                <div [ngClass]="{'col-md-2': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field>
                        <mat-select formControlName="ExDestination" name="ExDestination" placeholder="ExDestination">
                            <mat-option *ngFor="let party of parties" [value]="party.ExDestination">
                                {{party.ExDestination}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div [ngClass]="{'col-md-4': formType === 'A', 'col-md-6': formType === 'B'}">
                    <mat-form-field>
                        <mat-select formControlName="TargetCompID" name="TargetCompID" placeholder="Broker"
                            (selectionChange)="changeParty($event)" required>
                            <mat-option *ngFor="let party of parties" [value]="party.DeliveryToCompID">
                                {{party.CounterParty}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div class="row" [ngStyle]="{'display':formType === 'A' ? 'flex' : 'none'}">
                <div class="col-md-2">
                    <ra-input-rule-select formControlName="OrderCapacity" [disabledInput]="data.action === 'R'"
                        [selector]="['OrderCapacity']" [inputRules]="inputRules" [placeholder]="'Order Capacity'"></ra-input-rule-select>
                </div>
                <div class="col-md-4">
                </div>
                <div class="col-md-2">
                    <mat-form-field>
                        <mat-select formControlName="CommType" name="CommType" placeholder="CommType">
                            <mat-option *ngFor="let party of parties" [value]="party.CommType">
                                {{party.CommType}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="col-md-4">
                    <mat-form-field>
                        <input formControlName="DeliverToSubID" name="DeliverToSubID" matInput type="text" placeholder="Deliver Destination">
                    </mat-form-field>
                </div>
            </div>
            <div class="row" [ngStyle]="{'display':formType === 'A' ? 'flex' : 'none'}">
                <div class="col-md-6">
                </div>
                <div class="col-md-2">
                    <mat-form-field>
                        <input formControlName="Commission" name="Commission" matInput type="text" placeholder="Commission Amount">
                    </mat-form-field>
                </div>
                <div class="col-md-4">
                </div>
            </div>
            <div class="row" [ngStyle]="{'display':formType === 'A' ? 'flex' : 'none'}">
                <div class="col-md-8">
                    <mat-form-field>
                        <input name="Text" formControlName="Text" matInput placeholder="Additional Info">
                    </mat-form-field>
                </div>
                <div class="col-md-4">
                </div>
            </div>
        </form>
    </div>
</div>
<div mat-dialog-actions *ngIf="inicialized">
    <button mat-button (click)="onNoClick()">{{'butt.cancel' | translate}}</button>
    <span class="fill-remaining-space"></span>
    <button mat-button [disabled]="disabled || !isFormValid || this.orderForm.controls['TargetCompID'].invalid" (click)="sendOrder()">{{'butt.send'
        | translate}}</button>

</div>
